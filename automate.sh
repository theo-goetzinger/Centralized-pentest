#!/bin/bash

if [ -z "$IP" ]                                                             # Permet de vérifier que l'utilisateur entre bien une IP pour effectuer les scans
then                                                                       # Le -z retourne vrai si les strings sont nuls
        echo "Entrez une IP pour lancer le script: ./automate.sh <IP>"
        exit 1
fi

printf "\n----- NMAP -----\n\n" > results                       # Affichage du nmap dans results

echo "Running Nmap..."
nmap $IP -sC -sV -Pn -oN ./results                              # Lancement de la commande nmap

while read line                                                 
do
        if [[ $line == *open* ]] && [[ $line == *http* ]]       # Si nmap trouve ouvert le port 80, alors il lance un dirb + whatweb
        then
                echo "Running Dirb..."
                dirb http://$IP /usr/share/wordlists/dirb/common.txt -o temp1

        echo "Running WhatWeb..."
        whatweb $IP -v > temp2
        fi
done < results

if [ -e temp1 ]                                                 # Ecrire le résultat du dirb dans results
then
        printf "\n----- DIRS -----\n\n" >> results
        cat temp1 >> results
        rm temp1
fi

if [ -e temp2 ]                                                 # Ecrire le résultat du Whatweb dans results
then
    printf "\n----- WEB -----\n\n" >> results
        cat temp2 >> results
        rm temp2
fi

#cat results                                                    # Afficher l'ensemble des résultats
